"use strict";(self.webpackChunkaerospace_jam=self.webpackChunkaerospace_jam||[]).push([[8724],{4506:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"challenges/lidar/lidar","title":"LiDAR (TF-Luna)","description":"","source":"@site/docs/challenges/lidar/lidar.md","sourceDirName":"challenges/lidar","slug":"/challenges/lidar/","permalink":"/challenges/lidar/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":""},"sidebar":"tutorialSidebar","previous":{"title":"IR Transmitter (KY-005)","permalink":"/challenges/ir/"},"next":{"title":"RFID (RC522)","permalink":"/challenges/rfid/"}}');var a=n(4848),t=n(8453);const s={sidebar_position:3,description:""},d="LiDAR (TF-Luna)",l={},c=[{value:"Wiring",id:"wiring",level:2},{value:"Code",id:"code",level:2},{value:"Further Reading",id:"further-reading",level:2}];function o(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"lidar-tf-luna",children:"LiDAR (TF-Luna)"})}),"\n",(0,a.jsx)(r.h2,{id:"wiring",children:"Wiring"}),"\n",(0,a.jsx)(r.admonition,{type:"tip",children:(0,a.jsxs)(r.p,{children:["Source files for this diagram are available ",(0,a.jsx)(r.a,{href:"https://github.com/AerospaceJam/aerospacejam.github.io/blob/main/docs/challenges/lidar/lidar.fzz",children:"here"})]})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"Wiring diagram",src:n(2999).A+"",width:"1251",height:"633"})}),"\n",(0,a.jsx)(r.p,{children:"In case the above image is unclear, here's an additional schematic of the wiring as to prevent confusion:"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"Wiring schematic",src:n(6811).A+"",width:"651",height:"714"})}),"\n",(0,a.jsx)(r.h2,{id:"code",children:"Code"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-py",children:'from machine import UART, Pin\r\nimport utime\r\nfrom binascii import hexlify\r\n\r\nlidar = UART(0, baudrate=115200, tx=Pin(16), rx=Pin(17))\r\n\r\ndef save_settings() -> None:\r\n    """Saves the current settings to the Lidar."""\r\n    global lidar\r\n    lidar.write(bytes([0x5a, 0x04, 0x11, 0x6F]))\r\n    utime.sleep_ms(100)\r\n\r\ndef set_samp_rate(samp_rate: int = 20) -> None:\r\n    """\r\n    Sets the sampling rate of the Lidar.\r\n\r\n    Parameters:\r\n    - samp_rate: The desired sampling rate in Hz.\r\n    """\r\n    global lidar\r\n    hex_rate = samp_rate.to_bytes(2, \'big\')\r\n    samp_rate_packet = [0x5a, 0x06, 0x03, hex_rate[1], hex_rate[0], 0x00, 0x00]\r\n    lidar.write(bytes(samp_rate_packet))\r\n    utime.sleep(0.1)\r\n    save_settings()\r\n\r\ndef get_version() -> str:\r\n    """\r\n    Retrieves the Lidar version information.\r\n\r\n    Returns:\r\n    - A string representing the Lidar version.\r\n\r\n    Raises:\r\n    - RuntimeError: If the version retrieval fails.\r\n    """\r\n    global lidar\r\n    info_packet = [0x5a, 0x04, 0x14, 0x00]\r\n    lidar.write(bytes(info_packet))\r\n    start_tick = utime.time()\r\n    while utime.time() - start_tick < 10:\r\n        if lidar.any() > 0:\r\n            bin_ascii = lidar.read(30)\r\n            if bin_ascii and bin_ascii[0] == 0x5a:\r\n                version = bin_ascii[0:].decode(\'utf-8\')\r\n                return version\r\n            else:\r\n                lidar.write(bytes(info_packet))\r\n    raise RuntimeError("Failed to retrieve version.")\r\n\r\ndef get_lidar_data() -> tuple:\r\n    """\r\n    Retrieves the Lidar distance, strength, and temperature data.\r\n\r\n    Returns:\r\n    - A tuple (distance, strength, temperature) with the corresponding values.\r\n\r\n    Raises:\r\n    - RuntimeError: If data retrieval fails.\r\n    """\r\n    global lidar\r\n    while True:\r\n        if lidar.any() > 0:\r\n            bin_ascii = lidar.read(9)\r\n            if bin_ascii and len(bin_ascii) == 9 and bin_ascii[0] == 0x59 and bin_ascii[1] == 0x59:\r\n                distance = bin_ascii[2] + bin_ascii[3] * 256\r\n                strength = bin_ascii[4] + bin_ascii[5] * 256\r\n                temperature = (bin_ascii[6] + bin_ascii[7] * 256) / 8 - 256\r\n                return distance, strength, temperature\r\n        else:\r\n            return 0\r\n        utime.sleep_ms(10)\r\n\r\n# ----- Example usage -----\r\n# version = get_version()\r\n# print(version)\r\n# set_samp_rate(20)\r\n# while True:\r\n#     try:\r\n#         distance, strength, temperature = get_lidar_data()\r\n#         print(f"Distance: {distance}, Strength: {strength}, Temperature: {temperature:.2f}")\r\n#     except RuntimeError as e:\r\n#         print(e)\n'})}),"\n",(0,a.jsx)(r.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://en.benewake.com/DataDownload/index.aspx?pid=20&lcid=21",children:"https://en.benewake.com/DataDownload/index.aspx?pid=20&lcid=21"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://forums.raspberrypi.com/viewtopic.php?t=340841",children:"https://forums.raspberrypi.com/viewtopic.php?t=340841"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://files.seeedstudio.com/wiki/Grove-TF_Mini_LiDAR/res/SJ-PM-TF-Luna-A03-Product-Manual.pdf",children:"https://files.seeedstudio.com/wiki/Grove-TF_Mini_LiDAR/res/SJ-PM-TF-Luna-A03-Product-Manual.pdf"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://www.waveshare.com/wiki/TF-Luna_LiDAR_Range_Sensor",children:"https://www.waveshare.com/wiki/TF-Luna_LiDAR_Range_Sensor"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},2999:(e,r,n)=>{n.d(r,{A:()=>i});const i=n.p+"assets/images/lidar_bb-982b4d7cdc0950414a89976dc422b230.png"},6811:(e,r,n)=>{n.d(r,{A:()=>i});const i=n.p+"assets/images/lidar_schem-ef7c7c7407aa04502996f98e95a1d06d.png"},8453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>d});var i=n(6540);const a={},t=i.createContext(a);function s(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);